# tmux-agents-starter 統合ロードマップ

- 作成日: 2026-02-18
- 背景: tmux-agents-starter（パイプライン型オーケストレータ）の強みを dark-part-time-job（階層型オーケストレータ）に段階的に統合するための計画
- 参照: docs/comparison-tmux-agents-vs-dark-part-time-job.md

## 優先度テーブル

| 優先度 | 統合対象 | 概要 | 統合イメージ | 難易度 |
|:---:|---|---|---|:---:|
| S | 品質ゲート＋レビュープロセス | 向こうの品質アーキテクト＋2段階レビューに相当する仕組み | 若衆の成果物を別の若衆がレビュー → NG なら差し戻し YAML 発行。若頭が制御 | 中 |
| A | 差し戻しループ | レビュー NG 時のタスク再発行メカニズム | レビューNG時に若頭がタスクYAMLを再発行する仕組み。品質ゲートとセット | 中 |
| A | フィードバックループの形式化 | FB-*.md 的な学習記録の仕組み化 | 完了タスクから学習事項を抽出し、スキルとして蓄積。若頭が完了時に自動実行 | 低 |
| B | Living Spec（仕様の自動維持） | 実装結果で SPEC.md を自動更新 | yb plan で生成した SPEC.md を、実装完了時に実態と突合して更新する仕組み | 中 |
| B | マルチ LLM 対応 | ワーカーごとのモデル指定 | config.yaml でワーカーごとにモデル（Claude/Codex/Copilot 等）を指定可能にする | 低〜中 |
| C | 設計フェーズの強化 | 1st/2nd アーキテクト相当の役割追加 | アーキテクトペルソナを追加し、計画フェーズで設計書を作成・レビューする工程を組み込む | 中 |

## 優先度 S: 品質ゲート＋レビュープロセス

- **何を統合するか**: tmux-agents-starter 側の `quality-architect` ロール + `2nd-reviewer` による2段階レビュー + 差し戻しループに対応する仕組み。
- **なぜ必要か**: 現状は若衆の成果物が無検証で完了扱いになりやすく、品質担保がペルソナ依存で再現性が低い。
- **実装方針（概要）**: YAML キューで `implement -> review` のフェーズを定義し、`send-keys` で若衆Aの実装後に若衆B（`qa_engineer` ペルソナ）へレビュータスクを自動送信。`review_result: NG` なら若頭が差し戻しタスクYAMLを再発行する。
- **前提条件**: 優先度Aの差し戻しループ（レビューNG時の再発行メカニズム）が稼働していること。
- **影響範囲**: `waka.md` のワークフロー、タスクYAMLスキーマ（`review` フェーズ追加）、レポート取り回し。

## 優先度 A-1: 差し戻しループ

- **何を統合するか**: tmux-agents-starter の「2nd-reviewerがNG判定したら2nd-archへ差し戻す」再実装ループ。
- **なぜ必要か**: 現状のタスク進行が「実行 -> 報告」の単方向で、NG判定後に再発行する標準経路が存在しない。
- **実装方針（概要）**: レビュー担当若衆のレポートYAMLに `review_result`（`OK`/`NG`）を追加し、若頭が `NG` を検出した場合に修正指示付きタスクYAMLを再発行。`send-keys` で同一若衆または別若衆へ再投入する。
- **前提条件**: レポートYAMLスキーマに `review_result` フィールドを追加し、若頭側で判定できること。
- **影響範囲**: `waka.md` の報告受信フェーズ、タスクYAML/レポートYAMLスキーマ、再発行ルール。

## 優先度 A-2: フィードバックループの形式化

- **何を統合するか**: tmux-agents-starter の `FB-*.md` 的な学習記録フロー（教訓抽出と次回活用）。
- **なぜ必要か**: 現状は `skill_candidate_found` を若頭が手動で拾う運用で、学習の蓄積が体系化されていない。
- **実装方針（概要）**: 完了タスクのレポートYAMLから `lessons_learned` を抽出し、若頭が完了処理時に自動で `.yamibaito/skills/` へスキル候補を保存する。YAML キュー上では完了後フックとして扱う。
- **前提条件**: 既存のスキル化フロー（生成・格納・参照）が安定運用されていること。
- **影響範囲**: `waka.md` の完了処理、レポートYAMLスキーマ（`lessons_learned` 追加）、スキル蓄積運用。

## 優先度 B-1: Living Spec（仕様の自動維持）

- **何を統合するか**: tmux-agents-starter での「実装結果と `SPEC.md` を突合して更新する」運用。
- **なぜ必要か**: `yb plan` で作る `SPEC.md` が実装後に乖離しても更新されず、設計と実態のズレが蓄積する。
- **実装方針（概要）**: 実装完了イベントで若頭が突合タスクYAMLを自動発行し、レビュー担当若衆が `SPEC.md` と実装差分を確認して更新案を提出。`send-keys` で品質ゲート後に起動する。
- **前提条件**: 優先度Sの品質ゲートが先に稼働し、実装完了の品質判定が安定していること。
- **影響範囲**: `yb plan` のワークフロー、`waka.md` の完了処理、`SPEC.md` 更新手順。

## 優先度 B-2: マルチ LLM 対応

- **何を統合するか**: tmux-agents-starter のロール単位モデル選択（Claude/Codex/Copilot などの混在指定）。
- **なぜ必要か**: 現状は親分/若頭=Claude Code、若衆=Codex CLIで固定され、タスク特性に応じたモデル最適化ができない。
- **実装方針（概要）**: `config.yaml` にワーカーごとの `model` 指定を追加し、`worker_adapter` パターンで実行コマンドを切り替える。`send-keys` は既存のまま、起動時アダプタのみ差し替える。
- **前提条件**: `docs/plans/` にある `add-worker-runtime-adapter` 計画が先に実装されていること。
- **影響範囲**: `config.yaml` スキーマ、`yb_run_worker.sh`、ワーカー起動ロジック。

## 優先度 C: 設計フェーズの強化

- **何を統合するか**: tmux-agents-starter の `1st-architect`（情報収集）+ `2nd-architect`（設計書作成）に相当する2段階設計。
- **なぜ必要か**: `yb plan` で PRD/SPEC は生成できるが、アーキテクチャ設計の深掘りとレビューが薄い。
- **実装方針（概要）**: `persona_sets` にアーキテクトペルソナを追加し、計画フェーズで「設計書作成 -> 設計レビュー」のタスクYAMLを生成。`send-keys` で計画段階の若衆処理として実行する。
- **前提条件**: 優先度S（品質ゲート）と優先度B（Living Spec）が先に稼働し、設計変更の検証・反映経路が整っていること。
- **影響範囲**: `yb plan` フロー、`persona_sets` 拡充、計画テンプレート群。

## 注記

- 「ない」と「まだ作ってない」は違う。ウチの YAML キュー + send-keys アーキテクチャはこれらの機能を構造的に実現可能。段階的に載せていく。
- 統合は S → A → B → C の順で段階的に実施する。一気にやらない。
- 参照元の比較資料（docs/comparison-tmux-agents-vs-dark-part-time-job.md）の弱み分析には一部事実誤認がある（F005/RACE-001 の記載漏れ等）。
