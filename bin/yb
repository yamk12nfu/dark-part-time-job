#!/bin/bash
set -euo pipefail

ORCH_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

usage() {
  cat <<'EOF'
yb - yamibaito orchestrator

Usage:
  yb init [--repo <path>]
  yb start [--repo <path>] [--session <id>]
  yb restart [--repo <path>] [--session <id>]
  yb dispatch [--repo <path>] [--session <id>]
  yb collect [--repo <path>] [--session <id>]
  yb run-worker --repo <path> --worker <id> [--session <id>]
  yb help
EOF
}

cmd="${1:-help}"
shift || true

case "$cmd" in
  init)
    "$ORCH_ROOT/scripts/yb_init_repo.sh" "$@"
    ;;
  start)
    "$ORCH_ROOT/scripts/yb_start.sh" "$@"
    ;;
  restart)
    "$ORCH_ROOT/scripts/yb_restart.sh" "$@"
    ;;
  dispatch)
    "$ORCH_ROOT/scripts/yb_dispatch.sh" "$@"
    ;;
  collect)
    "$ORCH_ROOT/scripts/yb_collect.sh" "$@"
    ;;
  run-worker)
    "$ORCH_ROOT/scripts/yb_run_worker.sh" "$@"
    ;;
  help|-h|--help)
    usage
    ;;
  *)
    echo "Unknown command: $cmd" >&2
    usage
    exit 1
    ;;
esac
